# MAP-E

## network.wan6.ip6prefix について
| No. | 契約速度 (目安) | 光電話契約 | WAN6のIPv6プレフィックス取得方法 (一般的な想定)                                  | `network.wan6.ip6prefix` の手動設定の要否 (本スクリプトでの扱い案)            |
| :-: | :-------------- | :--------- | :------------------------------------------------------------------------------- | :-------------------------------------------------------------------------- |
|  1  | 1Gbps           | **なし**   | ISPがRA (ルーター広告) で `/64` プレフィックスのみを提供 (DHCPv6-PDによるプレフィックス委譲なし、または限定的)。 | **原則として手動設定を行う** (`${CE_NETWORK_PREFIX_FOR_WAN6}::/64` を設定)。 |
|  2  | 1Gbps           | **あり**   | ISPがDHCPv6-PDにより `/56` 等のプレフィックスを委譲。                               | **原則として手動設定しない** (DHCPv6-PDによる自動取得を期待)。                |
|  3  | 10Gbps          | **なし**   | ISPがDHCPv6-PDにより `/56` 等のプレフィックスを委譲 (近年の10Gプランでこの傾向)。      | **原則として手動設定しない** (DHCPv6-PDによる自動取得を期待)。                |
|  4  | 10Gbps          | **あり**   | ISPがDHCPv6-PDにより `/56` 等のプレフィックスを委譲。                               | **原則として手動設定しない** (DHCPv6-PDによる自動取得を期待)。                |

## 光電話契約での代表的なパターンとMAP-E動作

| 契約種別           | WAN6のGUA | PD配布 | MAP-E動作           |
|--------------------|:---------:|:------:|:-------------------|
| 1G/IPv6 only       | ○         | ×      | GUA優先（OK）      |
| 1G/光電話なし      | ○         | ×      | GUA優先（OK）      |
| 10G/光電話有       | ×         | ○      | PD利用（OK）       |
| 10G/光電話無       | ○/×       | ○      | GUA優先→PD（OK）   |
| 法人/特殊          | ×         | ○      | PD利用（OK）       |

- **GUA優先**：グローバルユニキャストアドレス（2000::/3）が取得できればそれを利用。
- **PD利用**：GUAが無い場合は、PD（Prefix Delegation）で配布されたprefixを利用。
- 「○/×」は環境やISP設定によりGUAがある場合とない場合があることを示す。
